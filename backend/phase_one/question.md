## 简述POW挖矿的过程，怎么处理分叉的情况
POW是 proof of work 即工作量证明，挖矿过程就是通过不断计算哈希找到符合难度要求的区块头，来竞争记账权，
并以此获得系统奖励
具体挖矿过程如下：
- 收集交易并打包成区块
  - 矿工从全节点的内存池（mempool）中挑选未打包的交易，然后把这些的交易打包进一个候选区块中，区块内容包含如下
    - 区块头
      - 版本号（version） 4字节
      - 父区块哈希（previous block hash） 32字节
      - 当前交易列表的merkle树根哈希（merkle root） 32字节
      - 时间戳（timestamp） 4字节
      - 难度目标（difficulty target） 4字节
      - 随机数（nonce） 4字节
    - 区块体
      - 第一个交易（coinbase）
      - 其他交易
      - 每个交易大概250字节，块大小不能超过1MB，所以大概有4000个交易
- 计算哈希（工作量证明）
  - 矿工不断修改区块头中的nonce计算哈希，直到计算出的哈希满足难度要求
    - 计算方式：sha-256(sha-256(block_header)) < difficulty target
  - 如果找到一个满足难度要求的哈希，则认为挖矿成功，否则继续修改nonce或者调整coinbase的内容并计算哈希
- 成功出块并广播
  - 如果矿工找到符合条件的哈希后，就会将该区块作为新区块加入到区块链末尾，并广播给其他节点
  - 其他节点收到该区块后，会验证该区块的合法性，并加入到区块链中
- 获得奖励
  - 奖励由区块奖励和交易手续费组成
  - 手续费是由交易中的输出金额减去输入金额得到
  - 奖励在挖矿成功时获得，但是有一定的冻结期，比如比特币需要100个区块后才能花费
- 共识达成与链延伸
  - 当其他矿工接受新的区块后，就会在这个基础上挖下一个区块
  - 如果出现分叉（即同时两个矿工出块），最终按最长链原则（即累计工作量最大），被全网接受为主链
- 分叉处理
  - 当出现分叉时，节点会暂时保留两个分支，当其中一个分支挖出更多的区块时，就会将这个分支作为主链，并丢弃掉其他分支
## 为什么说区块链是不可篡改的（密码学、共识）
- 密码学：
  - 区块链的区块头有重要的两个数据，当前区块的哈希，上一个区块的哈希引用，构建类似哈希指针链式数据结构
  - 哈希函数
    - 单向不可逆
    - 碰撞 resistant，只要哈希池够大，就理论上永远不会存在两个不同的输入生成相同的哈希
    - 随机性
    
## POW的难度调整机制
- 每产生2016块重新计算难度
- 难度调整方式：旧的难度值 * 2016块所产生的实际时间 / 2016块预期的时间

## 什么是双花，什么情况下会产生
- 双花（Double Spending）是指同一个数字货币被重复消费的行为，就是攻击者试图用一笔数字货币进行多次支付
- 什么情况下会产生
  - 交易未被充分被确认
    - 攻击者广播两笔相互冲突的交易（花同一笔币），商家未确认就发货
    - 分叉攻击，
  - 攻击者拥有51%算力，重写区块历史，使得成为主链

## POW与POS的区别是什么，优缺点

#### 区别

| 项目 | PoW（工作量证明）    | PoS（权益证明）      |
|:--|:--------------|:---------------|
| **核心资源** | 算力 + 电力       | 持币数量（质押）       |
| **出块方式** | 通过计算哈希竞争出块权   | 根据持币量和质押时间概率选出 |
| **激励方式** | 区块奖励 + 手续费    | 质押收益 + 手续费     |
| **能耗** | 高，需大量能源       | 低，几乎无计算浪费      |
| **安全来源** | 算力难以伪造        | 经济惩罚机制（罚没质押）   |
| **去中心化程度** | 算力易集中于矿池      | 资金易集中于大户       |
| **攻击门槛** | 需掌握全网 51% 算力  | 需持有全网 51% 质押代币 |
| **防双花机制** | 篡改需重新计算所有区块哈希 | 篡改会损失质押资产      |
| **激励诚实节点** | 诚实挖矿持续获利      | 诚实验证获得利息收益     |
| **惩罚机制** | 攻击失败浪费电力与算力   | 作恶节点会被罚没质押资金   |
| **交易确认速度** | 较慢（需多个区块确认）   | 较快（部分支持即时确认）   |
| **代表项目** | Bitcoin       | Ethereum 2.0   |

#### 优缺点

| 特性 | PoW（工作量证明）优点 | PoW（工作量证明）缺点 | PoS（权益证明）优点 | PoS（权益证明）缺点 |
|:--|:--|:--|:--|:--|
| 安全性 | 高，依赖算力，篡改成本大 | 无明显缺点 | 高，依赖质押经济惩罚 | 初期大户可能控制网络，存在经济攻击风险 |
| 能耗 | — | 极高，需大量电力 | 低，节能环保 | — |
| 去中心化 | 理论上好，任何矿工可参与 | 矿池算力集中可能导致中心化 | 不依赖算力，门槛低 | 富者恒富，持币多者优势大 |
| 交易确认 | 稳定可靠 | 速度慢，需要多个区块确认 | 快，部分PoS支持即时最终性 | — |
| 参与门槛 | 高，需要专业硬件 | 高 | 低，只需质押代币即可参与 | 质押越多，优势越大 |
| 协议复杂度 | 较简单 | — | 高，需要处理质押、随机出块、罚没等机制 | 高，系统设计复杂 |

## DPOS的机制，优缺点
### DPOS的机制
1. 质押与投票
  - 持币者将自己的代币质押（Stake）并投票选出一部分“代表节点”或“超级节点”（通常数量有限，例如 21 个或 101 个）。
  - 投票权重通常按质押数量决定。

2. 出块与验证
  - 被选出的代表节点轮流生成新区块并进行验证。
  - 如果节点按时出块且验证正确，会获得奖励。
  - 出块顺序和轮次通常预定，保证网络高效运行。
  - 出块节点可以选择部分奖励给投票人分红

3. 惩罚与替换
  - 若代表节点失职（如离线或作恶），会被投票淘汰，替换为其他节点。
  - 惩罚机制保证节点尽责，提高安全性。

### DPoS 优缺点
1. 优点
   - 不需要耗费能源和硬件设备；缩短了区块的产生时间和确认时间，提高了系统效率。
   - DPoS 不需要挖矿，也不需要全节点验证，而是由有限数量的见证节点进行验证，因此简单、高效。
2. 缺点
   - 为了提高效率，DPoS 以代理人共识取代全网共识，因此时常被抨击与区块链去中心化的理念相违背